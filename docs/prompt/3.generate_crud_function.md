# 基于DDL生成前后端代码

## SQL源文件
- DDL定义：docs/sql/init.sql
- 字典数据：docs/sql/dict.sql

## 代码生成规范
### 共同要求
1. 基于DDL定义及字典数据生成CRUD功能，功能包括新增、编辑、删除、批量删除、导入、导出、模板导出等功能，模板导出链接放到导入弹窗里
2. 前后端接口地址和数据格式完全一致
3. 字段校验：
    - 根据SQL定义的字段类型/长度在DTO和Query参数中添加校验注解
    - 覆盖查询/新增/编辑场景的输入校验
4. 导入和导出功能生成HTTP调用代码和API时要使用POST请求方式

### 后端规范（app模块）
1. 后端在app下面
2. 代码参照：后端代码参考Sample[Controller|DTO|Entiry|Mapper|Query|Service|ServiceImpl]生成
3. 权限控制：
    - @PreAuthorize注解格式：`@ss.hasPermi('模块名:action1:action2')`
    - 模块名与@RequestMapping路径首单词严格对应（全小写）
    - 示例：`@PreAuthorize("@ss.hasPermi('system:user:list')")`
4. 数据库操作：
    - Mapper.xml的insert语句不包含create_time/update_time/is_del字段
5. 数据对象转换：
    - 查询场景Controller、Service层只接受Query对象
    - 非查询场景Controller、Service层接受DTO对象
    - Service层与Mapper层之间要进行数据对象转换，处理请求时Service层DTO对象转为Mapper层的Entity对象，处理响应时Mapper层Entity转为Service层DTO对象
6. 禁用com.jd.lightning.common.utils.poi.ExcelUtil
7. 禁用java.utilList.of()方法


### 前端规范（web模块）
1. 前端在web工程下
2. 代码参照：web/src/**/*.vue,web/src/**/*.js
3. 列表展示：列表页展示 `*_val_set` 字段时，提取JSON的`key`作为表头、`val`作为值。
4. 数据校验：对前端页面所有输入项进行校验，包括列表页查询条件和新增、编辑页的输入项，参考建表DDL语句中的数据类型、格式及长度对输入项添加校验规则
5. 下载模板链接放到导入弹窗里
6. index.vue里的handleExport()参照web模块下src/views/system/user/index.vue写法

### 生成菜单数据
- 每一张表生成完CRUD功能后，基于其vue页面路径、Controller的@PreAuthorize()配置生成菜单数据SQL
- 生成的SQL写入docs模块下的sql/menu.sql文件中
- 示例：
  vue页面路径web/src/views/dur/liability/cash/flow/index -> component: dur/liability/cash/flow/index，path: liabilityCashFlow
  INSERT INTO alm.sys_menu (menu_name,parent_id,order_num,`path`,component,query,route_name,is_frame,is_cache,menu_type,visible,status,perms,icon,create_by,create_time,update_by,update_time,remark) VALUES
  ('现金流管理',1,1,'user','dur/liability/cash/flow/index','','',1,0,'C','0','0','dur:liability:cash:flow:list','user','admin','2025-04-10 12:44:11','',NULL,'用户管理菜单'),
  ('现金流查询',100,1,'','','','',1,0,'F','0','0','dur:liability:cash:flow:query','#','admin','2025-04-10 12:44:11','',NULL,''),
  ('现金流新增',100,2,'','','','',1,0,'F','0','0','dur:liability:cash:flow:add','#','admin','2025-04-10 12:44:11','',NULL,''),
  ('现金流修改',100,3,'','','','',1,0,'F','0','0','dur:liability:cash:flow:edit','#','admin','2025-04-10 12:44:11','',NULL,''),
  ('现金流删除',100,4,'','','','',1,0,'F','0','0','dur:liability:cash:flow:remove','#','admin','2025-04-10 12:44:11','',NULL,''),
  ('现金流导出',100,5,'','','','',1,0,'F','0','0','dur:liability:cash:flow:export','#','admin','2025-04-10 12:44:11','',NULL,''),
  ('现金流导入',100,6,'','','','',1,0,'F','0','0','dur:liability:cash:flow:import','#','admin','2025-04-10 12:44:11','',NULL,'');

### 注意事项
1. 严格按以上规范在指定模块目录下生成代码

## Agent任务操作
- 基于DDL生成前后端代码
- 按表DDL定义顺序针对每张表创建CURD
- 每个任务拆解尽可能小和细，以减少与大模型交互的token大小
- 不要自己创造表名，严格按DDL表名生成代码